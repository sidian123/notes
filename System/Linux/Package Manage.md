# 介绍

在Linux中, 程序发布时, 不会携带所需的依赖包, **包管理器**(Package Manager)用于解决该问题, 它会解析程序所需依赖包, 从**软件仓库**(Software Repository)中下载.

> 依赖就是二进制程序, 如同Windows的DLL, Java的Jar

通常在Linux中, 一个依赖只能存在一份, 因此当多个程序依赖于依赖的不同版本时, 冲突了, 造成[依赖地狱](https://en.wikipedia.org/wiki/Dependency_hell). 发行版维护的软件仓库缓解了依赖地狱的问题, 一般软件仓库中的所有包都不会冲突, 但是不能保证从第三方仓库中安装软件时不会造成依赖冲突.

> 这也是为啥每个不同的发行版都有一个软件仓库的原因
>
> 在Windows中, 允许软件自带依赖, 于是系统中可以存在多个不同版本的依赖, 从而解决软件依赖冲突.

Linux中冲突时咋解决? Google吧..

> 参考: [Dependency hell](https://en.wikipedia.org/wiki/Dependency_hell)

# 常用命令

*　常用命令及关系
  *　`dpkg`: 最底层的命令, 用于安装,构建,删除和管理Debian包(后缀`.deb`)
  *　`apt-get`: 基于`dpkg`命令, 提供更上层的命令. 相当于用户接口的前端
  *　`apt`: 基于`apt-get`, `apt-cache`, 简单的封装了下接口, 简化使用. 用于管理包, 能够处理包之间的依赖关系然后自动下载.
* 通常使用`apt`, 需要更底层功能时使用`apt-get`

> 详细见[deepin 程序管理](https://wiki.deepin.org/wiki/Deepin系统管理#.E7.A8.8B.E5.BA.8F.E7.AE.A1.E7.90.86)

下面列举一些常用的命令使用:

* `apt update`从配置文件中更新包信息, 大多数命令依赖与该信息执行的.
* `apt upgrade`更新所有从软件仓库中安装的包
* `apt install`安装
  * `-y` 一直`yes`
* `apt remote`删除, 但不删除配置文件
* `apt purge`删除包的配置文件
* `apt autoremove`删除自动安装, 现在却不再需要的包
* `apt search`搜索某个包
* `apt list`显示全部或满足规则的所有包. 
  * `--installed`已安装的
  * `--upgradeable`可升级的
  * `--all-versions`所有版本

# 软件源(弃)

> 没研究透, 仅供参考

这些命令安装的软件来源于软件源.

在以下两处可配置软件源

* `/etc/apt/sources.list`
* `/etc/apt/sources.list.d/` 用于添加源到一个单独的地方, 文件名一般以`.list`结尾, 如`vscode.list`

一般配置文件中一行为一条软件源, 软件版本冲突时, 先找到的优先级高. 软件源可以通过命令添加, 或直接编辑文件.

> 命令添加时用` add-apt-repository`, 一般该命令不是预装的.

## 配置

主要的是理清一条软件源的书写格式, 软件和源码源书写格式如下:

```plain
deb [ option1=value1 option2=value2 ] uri suite [component1] [component2] [...]
deb-src [ option1=value1 option2=value2 ] uri suite [component1] [component2] [...]
```

其他不谈, 主要看

* `uri`: 仓库所在的uri

* `deb`的类型主要由`suite/component`标识, `suite`一般与自己的仓库相关. 常选值为`stable main`

  > 错误纠正: 选值并不是这么简单, 具体不知. 还是建议用命令安装源

## 例子

这里添加wine源到deepin中

```plain
## Generated by deepin-installer
deb [by-hash=force] http://packages.deepin.com/deepin lion main contrib non-free
#deb-src http://packages.deepin.com/deepin lion main contrib non-free

# set by sidian
deb https://dl.winehq.org/wine-builds/ubuntu/ cosmic main
```

然后刷新配置到应用中

```bash
sudo apt-get update
```

# 换源

- **第一步**：使用一个Editor编辑文件，在此使用Vim进行编辑

  ```shell
  $ sudo vim /etc/apt/sources.list
  ```

- **第二步**：修改该文件，将该文件中原来的内容全部删除，添加如下内容（此处以阿里源作为示例）

  ```
  # 阿里源
  deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse
  deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse
  deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse
  deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse
  deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse
  deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse
  deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse
  deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse
  deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse
  deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse
  
  ```

- 然后使用下面命令更新一下更新一下

  ```shell
  $ sudo apt update && sudo apt upgrade
  ```

> 摘抄至https://www.jianshu.com/p/97c35d569aa3

# RPM

常用选项

> －ivh：安装显示安装进度--install--verbose--hash
> －Uvh：升级软件包--Update；
> －qpl：列出RPM软件包内的文件信息[Query Package list]；
> －qpi：列出RPM软件包的描述信息[Query Package install package(s)]；
>
> －qa:  查询linux系统中安装的所有软件；
> －qf：查找指定文件属于哪个RPM软件包[Query File]；
> －Va：校验所有的RPM软件包，查找丢失的文件[View Lost]；
> －e：删除包

> 参考[RPM 使用详解](https://blog.csdn.net/du_minchao/article/details/51671674)

# dpkg

```
安装deb软件包 dpkg -i xxx.deb

删除软件包 dpkg -r xxx.deb
 
连同配置文件一起删除 dpkg -r --purge xxx.deb
 
查看软件包信息 dpkg -info xxx.deb
 
查看文件拷贝详情 dpkg -L xxx.deb
 
查看系统中已安装软件包信息 dpkg -l
 
重新配置软件包 dpkg-reconfigure xx
 
sudo dpkg -p package_name卸载软件包及其配置文件，但无法解决依赖关系！
 
sudo aptitude purge pkgname卸载软件包及其配置文件与依赖关系包！ 
 
清除所有已删除包的残馀配置文件
dpkg -l |grep ^rc|awk '{print $2}' |sudo xargs dpkg -P
 
如果报如下错误，证明你的系统中没有残留配置文件了，无须担心。
```











