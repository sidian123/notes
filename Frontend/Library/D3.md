* 安装

  ```shell
  npm install d3 --save
  ```

* 引入

  d3由多个模块组成, 可将所有模块导入到名字空间`d3`中

  ```javascript
  import * as d3 from "d3";
  ```

  > `d3`这个包主要用于将其他模块暴露出来

  或者单独引入某个模块

  ```javascript
  import * as d3GeoProjection from "d3-geo-projection";
  ```

  或者引入模块中的某个对象

  ```javascript
  import {select, selectAll} from "d3-selection";
  import {geoPath} from "d3-geo";
  import {geoPatterson} from "d3-geo-projection";
  ```

  

# d3-force

* 介绍

  模拟作用力, 让粒子可以移动.

* force

  force是作用力的泛称, 在d3中简单的以函数表示, 能够修改节点的位置和速度. 

  如, 让节点向原点(0,0)移动

  ```javascript
  function force(alpha) {
    for (var i = 0, n = nodes.length, node, k = alpha * 0.1; i < n; ++i) {
      node = nodes[i];
      node.vx -= node.x * k;
      node.vy -= node.y * k;
    }
  }
  ```

  一般不自己实现, 而是使用已经实现好了的更具体的作用力.

* 已提供的作用力

  * Centering

    centering力使所有节点均匀移动到指定位置. 均匀指最终所有节点的重心在指定位置上.

  * Collision

    碰撞力

  * Links

    线的拉力或伸力

    > 和Many-Body不同, 该力由线提供.

  * Many-Body

    节点间的引力或斥力

  * Positioning

    将节点推到指定位置上.

* Demo案例

  * [超简单案例](https://jsfiddle.net/yuduxyz/gj78jLbL/6/)

# d3-drag

* 介绍

  封装了mouse和touch事件, 提供统一的drag事件

# d3-selection

## 介绍

* 功能

  * 选择DOM元素
* 操作DOM元素
  * 绑定数据

* 入门Demo

  ```javascript
  d3.select("body") // 选择元素body
    .append("svg")  // 在body中添加svg元素
  	// 为svg添加属性
      .attr("width", 960) 
      .attr("height", 500)
    .append("g") // 在svg中添加g元素
  	// 为g添加属性
      .attr("transform", "translate(20,20)")
    .append("rect") // 在g中添加rect元素
  	// 为rect添加属性
      .attr("width", 920)
      .attr("height", 460);
  ```

  一般的, 选择操作或添加操作方法会返回一个新的selection对象(代表被选择的元素集合), 指向被选择的或被添加的元素集合.

* selection对象

  大部分操作将返回selection对象, 表达被选中的集合.

  对象含有的属性

  * `_groups` 选中的元素集合
  * `_enter` 绑定数据后, 记录数据未匹配到元素的信息.
  * `_exit` 绑定数据后, 记录元素未匹配到数据的信息.
  * `_parents` 记录selection中所有元素的父元素集合.

  > 未绑定数据时, `_enter`, `_exit`都不存在.

## 操作

* 选择

  * `d3.select()` 选择第一个匹配的元素
  * `d3.selectAll()`选择所有匹配的元素
  * `selection.select()` 在selection中选择第一个匹配的元素
  * `selection.selectAll()` 在selection中选择所有匹配的元素

* DOM操作

  * `selection.attr()` 修改或获取元素属性
  * `selection.classed()` 修改或获取元素类
  * `selection.style()` 修改或获取元素样式
  * ...text...
  * ...html...
  * `selection.append()` 在selection的每个元素中添加一个新的元素. 返回被添加元素的selection.
  * `d3.create(name)` 创建和选择 detached 的元素.  `name`为元素的名字, 默认来自于HTML的名字空间. 创建其他元素, 如SVG, 需要加上前缀`svg:`

* 数据操作

  * *selection*.**data**([*data*[, *key*]])

    * 绑定数据`data`到selection上. 

    * *绑定规则* 

       `data`是任意元素的集合, 按索引依次与selection中的元素绑定. 无对应元素的数据, 记录在`selection._enter`中; 无对应数据的元素, 记录在`selection._exit`中. 并返回修改后的selection. 

    * 默认数据与selection中元素按照索引进行绑定的, 但可通过`key`方法修改该行为. 略
    * 元素绑定的数据可以来自父节点, 当父节点绑定的元素是数据时, 子元素可以获取并绑定. 此时`data`是方法, 参数为数组的单个元素. 使用见Demo

    > 仅绑定数据到selection上的元素上. 还仍需DOM操作, 将元素上的数据绑定到DOM元素中.

    > 对该方法返回的selection操作DOM, 操作仅作用于绑定了数据的元素.

  *  *selection*.**join**(*enter*[, *update*]\[, *exit*])

    添加, 删除, 重排元素, 达到与selection绑定的数据一致的目的, 然后返回selection

    * enter

      可以是字符串, 将以该字符串作为元素名, 为未匹配到元素的数字创建对应元素;

      可以是方法, 然后手动创建元素, 配置DOM

    * update

      方法, 用于操作已与数据绑定的元素

    * exit

      方法, 用于操作未绑定数据的元素.

    > 实质上, 该方法是 [*selection*.enter](https://github.com/d3/d3-selection/blob/v1.4.1/README.md#selection_enter), [*selection*.exit](https://github.com/d3/d3-selection/blob/v1.4.1/README.md#selection_exit), [*selection*.append](https://github.com/d3/d3-selection/blob/v1.4.1/README.md#selection_append), [*selection*.remove](https://github.com/d3/d3-selection/blob/v1.4.1/README.md#selection_remove), and [*selection*.order](https://github.com/d3/d3-selection/blob/v1.4.1/README.md#selection_order) 这些方法的简化使用.

## Demo

* demo1

  ```javascript
  const matrix = [
    [11975,  5871, 8916, 2868],
    [ 1951, 10048, 2060, 6171],
    [ 8010, 16145, 8090, 8045],
    [ 1013,   990,  940, 6907]
  ];
  
  d3.select("body") // 选中body
    .append("table") // body中添加table
    .selectAll("tr") // table中选择. 即使无元素, 但这一步用于与数据绑定. 当然, 无元素绑定到元素中, 将记录在_enter中.
    .data(matrix) // 绑定数据,按索引绑定, 每个元素对应一行
    .join("tr") // 对元素增删改, 最终DOM元素与数据保持一致. 
    .selectAll("td") // tr中选中, 用于下步绑定数据
    .data(d => d) // 使用父节点tr绑定的数组, 来绑定子节点td
    .join("td") // 增删改, 使DOM元素与数据一致.
      .text(d => d); // 修改td文件内容
  ```

* demo2

  ```javascript
  svg.selectAll("circle")
    .data(data)
    .join(
      enter => enter.append("circle").attr("fill", "green"),
      update => update.attr("fill", "blue"),
      exit => exit.remove()
    )
      .attr("fill", "none")
      .attr("stroke", "black");
  ```

## 注意点

最好明确selection的父元素, 否则将join到`html`元素下. 保险用法如

```javascript
d3.select('body') // p的父元素
	.selectAll('p') // 选中所有p, 准备绑定数据
	.data(...) // 绑定数据
    .join('p') // join, 新增的元素将挂载到父元素body下
```



# 资源

* [不同模块 & 例子](https://observablehq.com/@d3?tab=collections)

































